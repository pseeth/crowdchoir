<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>SHOUT</title>

   <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">


    <!-- Custom styles for this template -->
    <link href="jumbotron.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="../../assets/js/ie-emulation-modes-warning.js"></script>

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../../assets/js/ie10-viewport-bug-workaround.js"></script>

    <script src="jquery.js"></script>

    <script src="parse.js"></script>
 
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD0HFUld-nBgvzmNiDmiBMoyGVmIWIQdyA"></script>
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
<div class='container'>
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation" style="margin-bottom:50px">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">SHOUT</a>
        </div>
        <div class="navbar-collapse collapse">
        </div><!--/.navbar-collapse -->
      </div>
    </div>

<div>SHOUT
</div>

<p>
</p>
"



"
<p>
</p>

<h3 align='center'>SHOUT</h3>
<h5 align='center'>Voice pronunciation from around the world</h5>

</p>
<p text-align='center'>
    <div id="map-canvas" style='width:800px;height:400px;text-align:center; display:block; margin:0 auto;'></div>
</p>

<p text-align='center'>
       <button type ="request" href="/request" align="center" style="width:100px;height:50px;text-align:center" class="btn btn-default"value="Refresh">Request</button>
       <button type ="contribute" href="/contribute" align="center" class="btn btn-default" style="width:100px;height:50px;text-align:center;align:center" value="Refresh">Contribute</button>

    </div>
</p>

   <script>
   $( document ).ready(function() {
    
  Parse.initialize("RDZKYSEDdbsbk0HuL00sT7rKM2V6sr4HWb19dU6Q", "hygN6M2yPNEbgDEUHncJ9AIsMAyHb6lnUSRh6lJF");

  function initialize() { 
    var Parsemap = Parse.Object.extend("Run4You");
     
    var parsemap = new Parsemap();
    var userGeoPoint;
    var userLat;
    var userLong;

      if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(showPosition);
      } 

    function showPosition(position){
      userLat = position.coords.latitude;
      userLong = position.coords.longitude;
    }
    userGeoPoint = new Parse.GeoPoint({latitude:42.0572, longitude:-87.6764});
    // Create a query for places
    console.log(userGeoPoint);
    var query = new Parse.Query(Parsemap);
    // Interested in locations near user.
    query.near("location", userGeoPoint);
    query.find({
      success: function(placesObjects) {
          var userBlock = {}; 
        userBlock = JSON.parse(JSON.stringify(userGeoPoint));
        console.log(userBlock.latitude);
        var myLatlng = new google.maps.LatLng(userBlock.latitude, userBlock.longitude);
        var mapOptions = {
          zoom: 12,
         center: myLatlng
        }
        var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);


        $.each(placesObjects,function(k,v){
          var locationsBlock = {}; 
          locationsBlock = JSON.parse(JSON.stringify(v.get("location")));
          var pos = new google.maps.LatLng(locationsBlock.latitude,locationsBlock.longitude);

          var contentString = '<div id ="content">' + v.get("task") + ", " + "Contact: " + v.get("email") +'</div>';

          //Click to get ID or HTML (Write using Jquery)



               var infowindow = new google.maps.InfoWindow({
                content: contentString
              });

          var marker = new google.maps.Marker({
              position: pos,
              map: map,
              title: v.get("task")

          });

           google.maps.event.addListener(marker, 'click', function() {
            infowindow.open(map,marker);
          
          });
    });
  }
});
}

// google.maps.event.addDomListener(window, 'load', initialize);

  $('#helpForm').submit(function (event) {
    console.log("Submit");

    var Helpers = Parse.Object.extend("Run4You");
   
  // Create a new instance of that class.
    var helpers = new Helpers();

    helpers.set("task", $("#Task").val());
    helpers.set("name", $("#Name").val());
    helpers.set("email", $("#Email").val());
    helpers.set("address", $("#StreetAddress").val());
    helpers.set("city", $("#City").val());
    helpers.set("state", $("#State").val());
    helpers.set("zipcode", $("#Zipcode").val());

    var str = $("#StreetAddress").val();
    var street = str.split(" ");
    var url = "https://maps.googleapis.com/maps/api/geocode/json?key=AIzaSyD0HFUld-nBgvzmNiDmiBMoyGVmIWIQdyA&address=";
    var lat;
    var lng;
    $.each(street,function(k,v){
    url=url+v; 
    if(k == (street.length - 1)){
        url = url + ',+';
      }
    else {
      url = url + '+'
    }});

    url=url+$("#City").val();
    url=url+",+";
    var street2 = $("#City").val();
    var array = street2.split(" ");

    $.each(array,function(k,v){
    url=url+v;
    if(k == (array.length - 1)) {
        url = url + ',+';
      }
    else {
      url = url + '+'
    }});

    url=url+$("#State").val();
    url=url+",+";

    url=url+$("#Zipcode").val();
    $.getJSON(url,function(data){
      lat = data.results[0].geometry.location.lat;
      lng = data.results[0].geometry.location.lng; 
    });

    helpers.save(null, {
      success: function(helpers){
        var point = new Parse.GeoPoint({latitude: lat, longitude: lng});
        helpers.set("location", point);
        helpers.save();
        alert('Your request has been submitted!');
      },
      error: function(helpers,error){
        alert('There was an error!'+error.message);
      }

      // Clear the entry fields, clear textboxes -- call clear entries function and call a function to put that point onto the map -- add a local pin to the map (meteor)

    });

    event.preventDefault();
    });
  google.maps.event.addDomListener(window, "load", initialize);
   });

   </script>
 <footer>
        <p>&copy; SHOUT</p>
 </footer>


</body>
</html>

